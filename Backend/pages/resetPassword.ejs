<!DOCTYPE html>
<html>

<head>
    <title>Reset Password</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            font-size: 1.5rem;
        }

        form {
            width: 400px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        input {
            width: 100%;
            height: 50px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 1.5rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        button {
            background-color: #188c1b;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 1.5rem;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>
</head>

<body>
    <form id="resetPasswordForm">
        <input type="hidden" name="id" value="<%= id %>">
        <input type="hidden" name="token" value="<%= token %>">
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br><br>
        <label for="password_confirm">Confirm Password:</label>
        <input type="password" id="password_confirm" name="password_confirm" required><br><br>
        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <script>
        function submitForm() {
            const form = document.getElementById('resetPasswordForm');
            const formData = new FormData(form);

            const password = formData.get('password');
            const confirmPassword = formData.get('password_confirm');

            // Validate password strength
            if (!isStrongPassword(password)) {
                alert(
                    'Password must have:\n' +
                    '\u2022 At least 8 characters Length\n' +
                    '\u2022 Include at least one Symbol\n' +
                    '\u2022 Include at least one Uppercase Letter\n' +
                    '\u2022 Include at least one Lowercase Letter\n' +
                    '\u2022 Include at least one number'
                );
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            const requestBody = {
                id: formData.get('id'),
                token: formData.get('token'),
                password: password,
                password_confirm: confirmPassword
            };

            fetch('http://127.0.0.1:5000/api/user/reset-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to reset password');
                    }
                    window.location.href = 'http://localhost:3000/';
                    history.replaceState(null, '', 'http://localhost:3000/');
                })
                .catch(error => {
                    console.error('Error resetting password:', error);
                });
        }

        function isStrongPassword(password) {
            if (password.length < 8) {
                return false;
            }
            // Password must contain at least one symbol, one uppercase letter, one lowercase letter, and one number
            const symbolRegex = /[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/;
            const uppercaseRegex = /[A-Z]/;
            const lowercaseRegex = /[a-z]/;
            const numberRegex = /[0-9]/;

            return (
                symbolRegex.test(password) &&
                uppercaseRegex.test(password) &&
                lowercaseRegex.test(password) &&
                numberRegex.test(password)
            );
        }
    </script>
</body>

</html>